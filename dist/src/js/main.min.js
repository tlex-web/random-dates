class DateError extends Error{constructor(e,t){super(e),this.field=t}}let monthNumberFromString=e=>new Date(`${e} 01 2000`).toLocaleDateString("en",{month:"2-digit"});const getRandomInteger=(e,t)=>Math.floor(Math.random()*(t-e))+e,fetchPublicHolidays=async()=>{const e=await fetch("https://openholidaysapi.org/PublicHolidays?countryIsoCode=LU&languageIsoCode=EN&validFrom=2021-01-01&validTo=2021-12-31"),t=await e.json();let r=[];for(let e=0;e<t.length;++e)r[e]=new Date(t[e].startDate);return r};class PRNG{constructor(e){this._length=624,this.mt=new Array(this._length),this.index=0,this.mt[0]=e;for(let e=1;e<this._length;e++){const t=this.mt[e-1];this.mt[e]=1812433253*(t^t>>30)+e>>>0}}next(e,t){const r=this.generateRandomNumber()/4294967295,n=t-e+1;return Math.floor(r*n)+e}generateRandomNumber(){0===this.index&&this.generateNumbers();let e=this.mt[this.index];return e^=e>>11,e^=e<<7&2636928640,e^=e<<15&4022730752,e^=e>>18,this.index=(this.index+1)%this._length,e}generateNumbers(){for(let e=0;e<this._length;e++){const t=(2147483648&this.mt[e])+(2147483647&this.mt[(e+1)%this._length]);this.mt[e]=this.mt[(e+397)%624]^t>>1,t%2!=0&&(this.mt[e]^=2567483615)}}}class RandomDateSampler{constructor(e,t,r,n,i,s){this._start=0!==e.value.length?new Date(String(e.value)):void 0,this._end=0!==t.value.length?new Date(String(t.value)):void 0,this._batchSize=+r.value<=0?Math.abs(r.value):+r.value,this._seed=+n.value<=0?Math.abs(n.value):+n.value,this._prng=new PRNG(this._seed),this._weekend=!!i.checked,this._errorFields=s,this._batch=[],this._holidays=[],this._output=[],this._isError=!1}get error(){return this._isError}checkInput=()=>{if(!this._start)throw new DateError("Provide a date",0);if(!this._end)throw new DateError("Provide a date",1);if(this._start.valueOf()>this._end.valueOf())throw new DateError(`${this._end.toString().slice(0,10)} needs to be greater than ${this._start.toString().slice(0,10)}`,[0,1]);if(+this._start==+this._end)throw new DateError("Define a valid range",[0,1]);if(this._batchSize<=0)throw new DateError("Sample needs to be greater than 0",2);if(this.getDatesInRange(new Date(this._start),new Date(this._end),this._weekend).length<this._batchSize)throw new DateError("Extend the time frame or pick a lower sample size",[0,1,2,3]);if(!this._seed)throw new DateError("Provide a seed number",4);if(isNaN(this._seed))throw new DateError("Seed is not a number",4)};init(){try{this.checkInput(),this._isError=!1}catch(e){const{message:t,field:r}=e;if("object"==typeof r)this._isError=!0,r.forEach((e=>{this._errorFields[+e].innerHTML=t}));else{this._isError=!0;const e=+r;this._errorFields[e].innerHTML=t}}return!this._isError}print(){return[this._start,this._end,this._seed,this._weekend,this._batchSize,this._errorFields]}getDatesInRange=(e,t,r)=>{if("object"!=typeof e)throw new DateError("DateType",1);if("object"!=typeof t)throw new DateError("DateType",2);const n=[];for(let i=new Date(e);i<=new Date(t);i.setDate(i.getDate()+1))if(r?"Sat"!==i.toString().slice(0,3)&&"Sun"!==i.toString().slice(0,3)&&n.push(new Date(i)):n.push(new Date(i)),!n?.length)throw new DateError("Couldn't create batch",2);return n};createRandomSampleBatch=(e,t)=>{let r=[],n=[],i=e.length;for(let s=0;s<i;s++){const s=this._prng.next(0,i-1);if(n.includes(s)||r.push(e[s]),r.length===t)break;n.push(s)}if(r.length!==t)throw new DateError("Extend the time frame or pick a lower sample size",2);return r};createOutput=()=>{let e=[];try{const t=this.getDatesInRange(new Date(this._start),new Date(this._end),this._weekend);e=this.createRandomSampleBatch(t,this._batchSize).sort(((e,t)=>e-t))}catch(e){const{message:t,field:r}=e;if(this._isError=!0,!t||!r)throw new DateError(`${e}`,2);this._errorFields[+r].innerHTML=t}const t=[];return e.forEach((e=>{let r=`${e.toString().slice(8,10)}/${monthNumberFromString(e.toString().slice(4,8))}/${e.toString().slice(11,16)}`;t.push(`<li>${r}</li>`)})),{html_output:t,dates:e}}}const form=document.querySelector("form"),outputList=document.querySelector(".output-list"),submitBtn=document.querySelector('button[type="submit"]'),clipboard=document.querySelector("#clipboard"),txtBtn=document.querySelector("#txtBtn"),csvBtn=document.querySelector("#csvBtn"),jsonBtn=document.querySelector("#jsonBtn"),outputField=document.querySelectorAll(".hidden"),errorFields=document.querySelectorAll(".error");form.addEventListener("submit",(e=>{e.preventDefault();const{startDate:t,endDate:r,batchSize:n,seed:i,weekend:s}=e.target,o=new RandomDateSampler(t,r,n,i,s,errorFields);if(!o.init())return;const{html_output:a,dates:h}=o.createOutput();o.error&&h?.length||(errorFields.forEach((e=>e.innerHTML="")),outputField.forEach((e=>{e.classList.contains("hidden")&&e.classList.remove("hidden")}))),outputList.innerHTML=a.join(" ");const l=h.map((e=>`${e.toString().slice(8,10)}/${monthNumberFromString(e.toString().slice(4,8))}/${e.toString().slice(11,15)}`));clipboard.addEventListener("click",(async e=>{e.preventDefault(),await navigator.clipboard.writeText(l.join(",").replace(/,/g," ")),clipboard.innerHTML="Copied to clipboard"})),txtBtn.addEventListener("click",(e=>{e.preventDefault(),saveDataAsTXT("random_dates.txt",l.join(",").replaceAll(/,/g," "))})),csvBtn.addEventListener("click",(e=>{e.preventDefault(),saveDataAsCSV("random_dates.csv",l.join(",").replaceAll(/,/g," "))})),jsonBtn.addEventListener("click",(e=>{e.preventDefault(),saveDataAsJSON("random_dates.json",JSON.stringify({dates:l}))}))}));const saveDataAsTXT=(e,t)=>{const r=new Blob([t],{type:"text/plain;charset=utf-8"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(r,e);else{const t=window.document.createElement("a");t.href=window.URL.createObjectURL(r,{oneTimeOnly:!0}),t.download=e,t.click(),URL.revokeObjectURL(t.href)}},saveDataAsCSV=(e,t)=>{const r=new Blob([t],{type:"text/csv;charset=utf-8"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(r,e);else{const t=window.document.createElement("a");t.href=window.URL.createObjectURL(r,{oneTimeOnly:!0}),t.download=e,t.click(),URL.revokeObjectURL(t.href)}},saveDataAsJSON=(e,t)=>{const r=new Blob([t],{type:"text/json;charset=utf-8"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(r,e);else{const t=window.document.createElement("a");t.href=window.URL.createObjectURL(r,{oneTimeOnly:!0}),t.download=e,t.click(),URL.revokeObjectURL(t.href)}};